<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Device">

	<!-- resutlMap : to get List result -->
	<resultMap id="DeviceResult" type="com.icontrols.test.domain.Device">
		<result property="uId" column="uId" javaType="java.lang.String" />
		<result property="dId" column="dId" javaType="java.lang.String" />
		<result property="name" column="name" javaType="java.lang.String" />
		<result property="state" column="state" javaType="java.lang.Integer" />
		<result property="cmpCode" column="cmpCode" javaType="java.lang.Integer" />
		<result property="dtId" column="dtId" javaType="java.lang.String" />
	</resultMap>

	<!-- resultMap -->
	<select id="getDeviceById" parameterType="HashMap" resultMap="DeviceResult">
		SELECT uId, dId, name, state, dtId, cmpCode
		FROM device
		WHERE uId LIKE
		#{uId};
	</select>

	<insert id="insertDevice" parameterType="HashMap">
		INSERT INTO device
		(dId,
		uId, name, uptDt, state, dtId, cmpCode, subscriptionId)
		VALUES (#{dId},
		#{uId},
		#{name},NOW(), #{state}, #{dtId}, #{cmpCode}, #{subscriptionId});
	</insert>

	<update id="updateDeviceState" parameterType="HashMap">
		UPDATE device
		SET
		state = #{state}
		WHERE dId LIKE #{dId}
		AND uId LIKE #{uId};
	</update>

	<update id="updateDeviceStateSubscription" parameterType="HashMap">
		UPDATE
		device
		SET
		state = #{state}
		WHERE dId LIKE #{dId};
	</update>

	<select id="getDeviceCmpCode" parameterType="HashMap"
		resultType="Integer">
		SELECT cmpCode
		FROM device
		WHERE dId LIKE #{dId} AND uId LIKE
		#{uId};

	</select>

	<delete id="deleteDevice" parameterType="HashMap">
		delete from device
		WHERE
		dId LIKE #{dId} AND uId LIKE #{uId};
	</delete>

	<select id="getDIdByName" parameterType="HashMap" resultType="String">
		select dId
		from device
		where
		cmpCode = #{cmpCode} AND uId LIKE #{uId} AND
		name LIKE #{name};
	</select>

	<insert id="insertDeviceGroup" parameterType="HashMap">
		INSERT INTO
		device_group
		(dIds, uId, gId)
		VALUES (#{dIds}, #{uId},#{gId});
	</insert>

	<select id="getUIdByDId" parameterType="HashMap" resultType="String">
		select uId
		from device
		where dId like #{dId} limit 1 ;
	</select>

	<select id="getUIdsByDId" parameterType="HashMap" resultType="String">
		select uId
		from device
		where dId like #{dId};
	</select>

	<select id="getSubscriptionIdByDId" parameterType="HashMap"
		resultType="String">
		select subscriptionId
		from device
		where dId like #{dId} limit
		1 ;
	</select>

	<select id="getSubscriptionCnt" parameterType="HashMap"
		resultType="Integer">
		select count(subscriptionId)
		from device
		where dId like
		#{dId};
	</select>

	<update id="updateGroupState" parameterType="HashMap">
		UPDATE
		device
		SET
		state = #{state}
		WHERE dId LIKE #{dId};
	</update>

	<select id="getGIdBydId" parameterType="HashMap" resultType="String">
		select gId
		from device_group
		where dIds like #{dId};
	</select>

	<select id="getDeviceGroupDids" parameterType="HashMap"
		resultType="String">
		select dIds
		from device_group
		where uId like #{uId} and gId
		like #{gId};
	</select>

	<select id="getDeviceStateByDId" parameterType="HashMap"
		resultType="Integer">
		select state
		from device
		where dId like #{dId} and uId like
		#{uId};
	</select>

</mapper>